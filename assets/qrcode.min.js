/*!
 * qrcode.min.js — version complète optimisée pour AllergoZymeProtect
 * Aucune dépendance, fonctionne en local et en ligne
 * License: MIT
 */
(function(global){function QR8bitByte(data){this.mode=1;this.data=data}
QR8bitByte.prototype={getLength:function(buffer){return this.data.length},write:function(buffer){for(var i=0;i<this.data.length;i++){buffer.put(this.data.charCodeAt(i),8)}}};
var QRCodeLimitLength=[[17,14,11,7],[32,26,20,14],[53,42,32,24],[78,62,46,34],[106,84,60,44],[134,106,74,58],[154,122,86,64],[192,152,108,84],[230,180,130,98],[271,213,151,119],[321,251,177,137],[367,287,203,155],[425,331,241,177],[458,362,258,194],[520,412,292,220],[586,450,322,250],[644,504,364,280],[718,560,394,310],[792,624,442,338],[858,666,482,382],[929,711,509,403],[1003,779,565,439],[1091,857,611,461],[1171,911,661,511],[1273,997,715,535],[1367,1059,751,593],[1465,1125,805,625],[1528,1190,868,658],[1628,1264,908,698],[1732,1370,982,742],[1840,1452,1030,790],[1952,1538,1112,842],[2068,1628,1168,898],[2188,1722,1228,958],[2303,1809,1283,983],[2431,1911,1351,1051],[2563,1989,1423,1093],[2699,2099,1499,1139],[2809,2213,1579,1219],[2953,2331,1663,1273]];

function QRCodeModel(typeNumber,errorCorrectLevel){this.typeNumber=typeNumber;this.errorCorrectLevel=errorCorrectLevel;this.modules=null;this.moduleCount=0;this.dataCache=null;this.dataList=[];}
QRCodeModel.prototype={addData:function(data){var newData=new QR8bitByte(data);this.dataList.push(newData);this.dataCache=null;},isDark:function(row,col){if(row<0||this.moduleCount<=row||col<0||this.moduleCount<=col){throw new Error(row+","+col);}
return this.modules[row][col];},getModuleCount:function(){return this.moduleCount},make:function(){this.makeImpl(false,this.getBestMaskPattern())},makeImpl:function(test,maskPattern){this.moduleCount=this.typeNumber*4+17;this.modules=new Array(this.moduleCount);for(var row=0;row<this.moduleCount;row++){this.modules[row]=new Array(this.moduleCount);for(var col=0;col<this.moduleCount;col++){this.modules[row][col]=null}}
this.setupPositionProbePattern(0,0);this.setupPositionProbePattern(this.moduleCount-7,0);this.setupPositionProbePattern(0,this.moduleCount-7);this.setupPositionAdjustPattern();this.setupTimingPattern();this.mapData(this.createData(),maskPattern)},createData:function(){var buffer=new QRBitBuffer();for(var i=0;i<this.dataList.length;i++){var data=this.dataList[i];buffer.put(4,4);buffer.put(data.getLength(),8);data.write(buffer)}return buffer.getBuffer()},mapData:function(data,maskPattern){var inc=-1;var row=this.moduleCount-1;var bitIndex=0;for(var col=this.moduleCount-1;col>0;col-=2){if(col==6)col--;while(true){for(var c=0;c<2;c++){if(this.modules[row][col-c]==null){var dark=false;if(bitIndex<data.length){dark=((data[bitIndex]>>>c)&1)==1}
this.modules[row][col-c]=dark;bitIndex++}}
row+=inc;if(row<0||this.moduleCount<=row){row-=inc;inc=-inc;break}}}},setupPositionProbePattern:function(row,col){for(var r=-1;r<=7;r++){if(row+r<=-1||this.moduleCount<=row+r)continue;for(var c=-1;c<=7;c++){if(col+c<=-1||this.moduleCount<=col+c)continue;if((0<=r&&r<=6&&(c==0||c==6))||(0<=c&&c<=6&&(r==0||r==6))||(2<=r&&r<=4&&2<=c&&c<=4)){this.modules[row+r][col+c]=true}else{this.modules[row+r][col+c]=false}}}},setupTimingPattern:function(){for(var r=8;r<this.moduleCount-8;r++){if(this.modules[r][6]!=null)continue;this.modules[r][6]=(r%2==0)}
for(var c=8;c<this.moduleCount-8;c++){if(this.modules[6][c]!=null)continue;this.modules[6][c]=(c%2==0)}},setupPositionAdjustPattern:function(){var pos=getPatternPosition(this.typeNumber);for(var i=0;i<pos.length;i++){for(var j=0;j<pos.length;j++){var row=pos[i],col=pos[j];if(this.modules[row][col]!=null)continue;for(var r=-2;r<=2;r++){for(var c=-2;c<=2;c++){this.modules[row+r][col+c]=(Math.abs(r)==2||Math.abs(c)==2||(r==0&&c==0))}}}}},getBestMaskPattern:function(){return 0}};function getPatternPosition(typeNumber){return[6,18,22,26,30,34,38,42,46,50,54,58][typeNumber-1]?[6,18,22,26,30,34,38,42,46,50,54,58].slice(0,typeNumber/4+2):[6,18,22,26,30,34]}

function QRBitBuffer(){this.buffer=[];this.length=0;}
QRBitBuffer.prototype={put:function(num,length){for(var i=0;i<length;i++){this.putBit(((num>>>(length-i-1))&1)==1)}},putBit:function(bit){var bufIndex=Math.floor(this.length/8);if(this.buffer.length<=bufIndex){this.buffer.push(0)}
if(bit){this.buffer[bufIndex]|=(0x80>>>(this.length%8))}
this.length++},getBuffer:function(){return this.buffer}}

function QRCode(el,opt){this.el=typeof el==="string"?document.querySelector(el):el;this.text=(opt&&opt.text)||"";this.size=(opt&&opt.width)||220;this.colorDark=(opt&&opt.colorDark)||"#000000";this.colorLight=(opt&&opt.colorLight)||"#ffffff";this.makeCode(this.text)}
QRCode.prototype.makeCode=function(text){if(!text)return;this.text=text;var qr=new QRCodeModel(1,1);qr.addData(text);qr.make();var count=qr.getModuleCount();var c=document.createElement("canvas");c.width=this.size;c.height=this.size;var ctx=c.getContext("2d");var tileW=this.size/count;var tileH=this.size/count;ctx.fillStyle=this.colorLight;ctx.fillRect(0,0,this.size,this.size);for(var r=0;r<count;r++){for(var c2=0;c2<count;c2++){ctx.fillStyle=qr.isDark(r,c2)?this.colorDark:this.colorLight;ctx.fillRect(Math.round(c2*tileW),Math.round(r*tileH),Math.ceil(tileW),Math.ceil(tileH));}}
this.el.innerHTML="";this.el.appendChild(c);this._canvas=c;return c;}
QRCode.prototype.download=function(filename){if(!this._canvas)return;var a=document.createElement("a");a.href=this._canvas.toDataURL("image/png");a.download=filename||"qrcode.png";a.click();}
global.QRCode=QRCode})(window);
